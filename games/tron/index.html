<!DOCTYPE html>
	<head>
		<title>TRON | Valyr Knight</title>
		<link rel="shortcut icon" href="tron.favicon.png"> 
	</head>
	<style type="text/css">
		@import url('https://fonts.googleapis.com/css?family=Roboto+Mono');
		body {
			padding:0;
			margin:0;
			font-family:Roboto Mono, monospace;
			background-color:black;
			color:white;
			position:fixed;
		}
      	a {text-decoration:none; color:inherit;}
      	h1 {font-size:40px}
		.store {display:none;}
		#back {
			border:30px solid white;
			margin-top:-60px;
			margin-left:-60px;
		}
		#message_box {
			width:400px;
			position:fixed;
			top:50vh;
			margin-top:10px;
			left:50vw;
			margin-left:-195px;
			border:5px solid white;
			text-align:center;
			z-index:1;
			display:block;
			background-color:black;
			padding-bottom:15px;
			padding-top:0px;
			font-size:20px;
		}
		#message_title {margin-top:10px;margin-bottom:-20px;}
		#message {font-family:arial}
		#store_div {
			font-family:arial;
			display:none;
			position:fixed;
			right:30px;
			bottom:30px;
			z-index:15;
			border:2px solid #16ff00;
			padding-left:20px;
			width:130px;
		}
		#play_button {
			display:block;
			margin:auto;
			padding:10px;
			border:2px solid white;
			padding-top:15px;
			font-size:18px;
			width:120px;
			margin-top:-10px;
			background:white;
			color:black;
		}
		#play_button:hover {background:black; color:white;}
		#play_button:active {background:white; color:black;}
		#maps_div {
			display:none;
			margin:auto;
			width:80%;
		}
		.map_button {
			display:inline-block;
			position:static;
			margin:80px;
			padding:10px;
			border:2px solid white;
			padding-top:12px;
			font-size:14px;
			width:100px;
			margin:10px;
			background:white;
			color:black;
		}
		.map_button:hover {background:black; color:white;}
		.map_button:active {background:black; color:white;}
		/*#map_button1 {margin-bottom:0px;}
		#map_button2 {margin-bottom:0px;}
		#map_button3 {margin-left:2px;}
		#map_button4 {}*/
		#play2 {display:none;}
		#play3 {display:none;}
		.pink {color:#ff00ff;}
		.blue {color:#00ffff;}
		@font-face {
			font-family: JLSSpaceGothicR_NC;
			src: url(/fonts/JLSSpaceGothicR_NC.otf);
		}
	</style>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script type="text/javascript">
		$(document).on("keypress", function(e) { //Detect key pressing, change player direction
		    print("key", e.which);
		    var blue = get("blueDirOld");
		    var red = get("redDirOld");
		    if (e.which == 119 && blue != "d") { //w
		    	print("blueDir", "u");
		    } else if (e.which == 115 && blue != "u") { //s
		    	print("blueDir", "d");
		    } else if (e.which == 97 && blue != "r") { //a
		    	print("blueDir", "l");
		    } else if (e.which == 100 && blue != "l") { //d
		    	print("blueDir", "r");
		    } else 
		    if (e.which == 105 && red != "d") { //i
		    	print("redDir", "u");
		    } else if (e.which == 107 && red != "u") { //k
		    	print("redDir", "d");
		    } else if (e.which == 106 && red != "r") { //j
		    	print("redDir", "l");
		    } else if (e.which == 108 && red != "l") { //l
		    	print("redDir", "r");
		    } else 
		    if ((e.which == 13 || e.which == 32) && (get("redWin") == "0" && get("blueWin") == "0")) {
		    	start();
		    }
		});
		function setup() { //runs on start
			checkScreen();
			backFormat();
			return false;
		}
		function checkScreen() { 
	        if (window.innerHeight > window.innerWidth) { //check mobile
	        	confirm("This page is designed for desktop users. \n If you are using a mobile device you may receive a sum-optimal experience.")
	        }
	        if (window.innerHeight < 480 || window.innerWidth < 450) { //check tiny window
	        	confirm("Your webpage could be too small to play this game. \n You may receive a sum-optimal experience.")
	        }
	        return false;
	    }
		function backFormat() { //format <canvas> 
			var w_full = window.innerWidth;
			var h_full = window.innerHeight;
			//calc, set width
			var w = w_full - (w_full%20) - 15;
			if ((w - 5)%40 == 0) w -= 20;
			var w_margin = -30 + ((w_full - w)/2);
			document.getElementById("back").width = w;
			document.getElementById("back").style.marginLeft = w_margin + "px"; //*/
			//calc, set height
			var h = h_full - (h_full%20) - 15;
			if ((h - 5)%40 == 0) h -= 20;
			var h_margin = -30 + ((h_full - h)/2);
			document.getElementById("back").height = h;
			document.getElementById("back").style.marginTop = h_margin + "px";
			//set height width vars
			var horzNum = (w-5)/20;
			var vertNum = (h-5)/20;
			print("horzNum", horzNum);
			print("vertNum", vertNum);
			//start logo draw
			horzNum = horzNum + (horzNum%2);
			horzNum = (horzNum/2) - 13;
			vertNum = vertNum - (vertNum%2);
			vertNum = (vertNum/2) - 7;
			drawTRON(horzNum, vertNum);
			return false;
		}
		function start() { //start running games
			document.getElementById("message_box").style.display = "none";
			//set vertical positions
			var y = parseInt(get("vertNum"));
			y = y - (y%2);
			y = y/2;
			y = y - 2;
			print("redY", y);
			print("blueY", y);
			print("blueDir", "l");
			//set horizontal positions
			var x = parseInt(get("horzNum"));
			x = x - (x%2);
			x = x/2;
			x = x - 6;
			print("blueX", x);
			print("redX", parseInt(get("horzNum")) - x);
			print("redDir", "r");
			//set wins to no win, laying
			print("redWin", "f");
			print("blueWin", "f");

			map();
			//start move repeating
			if (get("round") == "0") {
				var run = setInterval(move, 100); 
				print("round", "1");
			} else if (get("round") == "n") {
				move();
			}
			return false;
		}
		function move() {
			if (get("redWin") == "f" && get("blueWin") == "f") {
				var canvas = document.getElementById("back");
				var back = canvas.getContext("2d");
				//move blue, check impact
				var x = parseInt(get("blueX"));
				var y = parseInt(get("blueY"));
				var dir = get("blueDir")
				drawBlock("blue", x, y);
				if (dir == "l") {
					x -= 1;
					print("blueX", x);
					if (x < 0) print("redWin", "t");
				} else if (dir == "r") {
					x += 1;
					print("blueX", x);
					if (x > parseInt(get("horzNum"))) print("redWin", "t");
				} else if (dir == "u") {
					y -= 1;
					print("blueY", y);
					if (y < 0) print("redWin", "t");
				} else if (dir == "d") {
					y += 1;
					print("blueY", y);
					if (y > parseInt(get("vertNum"))) print("redWin", "t");
				} 
				if (getBlue(dimension(x), dimension(y)) == 0) {
					drawBlock("blue_car", x, y);
					print("blueDirOld", dir);
				} else {
					drawBlock("white", x, y);
					print("redWin", "t");
				}
				//move red, check impact
				x = parseInt(get("redX"));
				y = parseInt(get("redY"));
				dir = get("redDir")
				drawBlock("red", x, y);
				if (dir == "l") {
					x -= 1;
					print("redX", x);
					if (x < 0) print("blueWin", "t");
				} else if (dir == "r") {
					x += 1;
					print("redX", x);
					if (x > parseInt(get("horzNum"))) print("blueWin", "t");
				} else if (dir == "u") {
					y -= 1;
					print("redY", y);
					if (y < 0) print("blueWin", "t");
				} else if (dir == "d") {
					y += 1;
					print("redY", y);
					if (y > parseInt(get("vertNum"))) print("blueWin", "t");
				} 
				if (getBlue(dimension(x), dimension(y)) == 0) {
					drawBlock("red_car", x, y);
					print("redDirOld", dir)
				} else {
					drawBlock("white", x, y);
					print("blueWin", "t");
				} 
			} else { //start win
				if (get("redWin") == "t" && get("blueWin") == "t") {
					win("Tie");
				} else if (get("redWin") == "t" && get("blueWin") == "f") {
					win("Pink");
				} else if (get("redWin") == "f" && get("blueWin") == "t") {
					win("Blue");
				}
				clearInterval(run);
			}
		}
		function getBlue(x, y) { //get blue value of location
			var canvas = document.getElementById('back');
			var context = canvas.getContext('2d');
			var imageData = context.getImageData(x, y, 1, 1);
			var data = imageData.data;
			var blue = data[2];
			return blue;
		}
		function win(color) { //stop game, once won
			//alert("win = 0");
			print("blueWin", "0");
			print("redWin", "0");
			//alert("round = n");
			//change start button
			if (get("round") == "1") {
				print("round", "n");
				print("play_button", "RE-PLAY");
			}
			//change main message
			//alert("message = winner")
			if (color == "Tie") {
				print("message_title", "Tie");
			} else {
				print("message_title", "<span class=" + color.toLowerCase() + ">" + color + "</span> Wins!");
			}
			//alert("div = dispalay");
			document.getElementById("message_box").style.display = "block";
			document.getElementById("maps_div").style.display = "inherit";
			
			return false;
		}
		function draw(color, x, y, w, h) { //draw colored square (uses <canvas> coordinates)
			var canvas = document.getElementById("back");
			var back = canvas.getContext("2d");
			if (color == "blue") {
				var img = document.getElementById("blue");
			} else if (color == "red") {
				var img = document.getElementById("red");
			} else if (color == "white") {
				var img = document.getElementById("white");
			} else if (color == "blue_car") {
				var img = document.getElementById("blue_car");
			} else if (color == "red_car") {
				var img = document.getElementById("red_car");
			} else {
				var img = document.getElementById("black");
			}
			back.drawImage(img, x, y, w, h);
			return false;
		}
		function drawBlock(color, x, y) { //draw block (uses block coordinates)
			if (x > parseInt(get("horzNum")) || y > parseInt(get("vertNum"))) return false;
			x = (x*20) + 5;
			y = (y*20) + 5;
			draw(color, x, y, 15, 15);
			return false;
		}
		function dimension(x) { return (x*20) + 10; } //get single pixel in a block (used to check color)
		function get(id) { return document.getElementById(id).innerHTML; } //get text for html tag
		function print(loc, text) { //change text of html tag
          document.getElementById(loc).innerHTML = text;
          return false;
        }
        function drawTRON(x, y) { setTimeout(traceTRON, 100, x, y, 0); } //starts drawing logo
        function traceTRON(x, y, num) { //draws logo
        	if (get("round") != "0") return false;
        	if (num == 0) {
        		drawBlock("blue_car", x+3, y+6); //T vert
        		drawBlock("red_car", x, y); //T top
        		drawBlock("blue_car", x+8, y+6); //R vert
        		drawBlock("red_car", x+11, y); //R curve
        		drawBlock("blue_car", x+16, y); //O left
        		drawBlock("red_car", x+18, y+6); //O right
        		drawBlock("blue_car", x+21, y+6); //N left
        		drawBlock("red_car", x+25, y); //N right
        	} else if (num == 1) {
        		drawBlock("blue", x+3, y+6); //T vert
        		drawBlock("red", x, y); //T top
        		drawBlock("blue", x+8, y+6); //R vert
        		drawBlock("red", x+11, y); //R curve
        		drawBlock("blue", x+16, y); //O left
        		drawBlock("red", x+18, y+6); //O right
        		drawBlock("blue", x+21, y+6); //N left
        		drawBlock("red", x+25, y); //N right

        		drawBlock("blue_car", x+3, y+5); //T vert
        		drawBlock("red_car", x+1, y); //T top
        		drawBlock("blue_car", x+8, y+5); //R vert
        		drawBlock("red_car", x+12, y); //R curve
        		drawBlock("blue_car", x+15, y+1); //O left
        		drawBlock("red_car", x+19, y+5); //O right
        		drawBlock("blue_car", x+21, y+5); //N left
        		drawBlock("red_car", x+25, y+1);
        	} else if (num == 2) {
        		drawBlock("blue", x+3, y+5); //T vert
        		drawBlock("red", x+1, y); //T top
        		drawBlock("blue", x+8, y+5); //R vert
        		drawBlock("red", x+12, y); //R curve
        		drawBlock("blue", x+15, y+1); //O left
        		drawBlock("red", x+19, y+5); //O right
        		drawBlock("blue", x+21, y+5); //N left
        		drawBlock("red", x+25, y+1);

        		drawBlock("blue_car", x+3, y+4); //T vert
        		drawBlock("red_car", x+2, y); //T top
        		drawBlock("blue_car", x+8, y+4); //R vert
        		drawBlock("red_car", x+13, y+1); //R curve
        		drawBlock("blue_car", x+15, y+2); //O left
        		drawBlock("red_car", x+19, y+4); //O right
        		drawBlock("blue_car", x+21, y+4); //N left
        		drawBlock("red_car", x+25, y+2); //N right
        	} else if (num == 3) {
        		drawBlock("blue", x+3, y+4); //T vert
        		drawBlock("red", x+2, y); //T top
        		drawBlock("blue", x+8, y+4); //R vert
        		drawBlock("red", x+13, y+1); //R curve
        		drawBlock("blue", x+15, y+2); //O left
        		drawBlock("red", x+19, y+4); //O right
        		drawBlock("blue", x+21, y+4); //N left
        		drawBlock("red", x+25, y+2); //N right

        		drawBlock("blue_car", x+3, y+3); //T vert
        		drawBlock("red_car", x+3, y); //T top
        		drawBlock("blue_car", x+8, y+3); //R vert
        		drawBlock("red_car", x+13, y+2); //R curve
        		drawBlock("blue_car", x+15, y+3); //O left
        		drawBlock("red_car", x+19, y+3); //O right
        		drawBlock("blue_car", x+21, y+3); //N left
        		drawBlock("red_car", x+25, y+3); //N right
        	} else if (num == 4) {
        		drawBlock("blue", x+3, y+3); //T vert
        		drawBlock("red", x+3, y); //T top
        		drawBlock("blue", x+8, y+3); //R vert
        		drawBlock("red", x+13, y+2); //R curve
        		drawBlock("blue", x+15, y+3); //O left
        		drawBlock("red", x+19, y+3); //O right
        		drawBlock("blue", x+21, y+3); //N left
        		drawBlock("red", x+25, y+3); //N right

        		drawBlock("blue_car", x+3, y+2); //T vert
        		drawBlock("red_car", x+4, y); //T top
        		drawBlock("blue_car", x+8, y+2); //R vert
        		drawBlock("red_car", x+12, y+3); //R curve
        		drawBlock("blue_car", x+15, y+4); //O left
        		drawBlock("red_car", x+19, y+2); //O right
        		drawBlock("blue_car", x+21, y+2); //N left
        		drawBlock("red_car", x+25, y+4); //N right
        	} else if (num == 5) {
        		drawBlock("blue", x+3, y+2); //T vert
        		drawBlock("red", x+4, y); //T top
        		drawBlock("blue", x+8, y+2); //R vert
        		drawBlock("red", x+12, y+3); //R curve
        		drawBlock("blue", x+15, y+4); //O left
        		drawBlock("red", x+19, y+2); //O right
        		drawBlock("blue", x+21, y+2); //N left
        		drawBlock("red", x+25, y+4); //N right

        		drawBlock("blue_car", x+3, y+1); //T vert
        		drawBlock("red_car", x+5, y); //T top
        		drawBlock("blue_car", x+8, y+1); //R vert
        		drawBlock("red_car", x+11, y+3); //R curve
        		drawBlock("blue_car", x+15, y+5); //O left
        		drawBlock("red_car", x+19, y+1); //O right
        		drawBlock("blue_car", x+21, y+1); //N left
        		drawBlock("red_car", x+25, y+5); //N right
        	} else if (num == 6) {
        		drawBlock("blue", x+3, y+1); //T vert
        		drawBlock("red", x+5, y); //T top
        		drawBlock("blue", x+8, y+1); //R vert
        		drawBlock("red", x+11, y+3); //R curve
        		drawBlock("blue", x+15, y+5); //O left
        		drawBlock("red", x+19, y+1); //O right
        		drawBlock("blue", x+21, y+1); //N left
        		drawBlock("red", x+25, y+5); //N right

        		drawBlock("white", x+3, y); //T vert
        		drawBlock("red_car", x+6, y); //T top
        		drawBlock("blue_car", x+8, y); //R vert
        		drawBlock("red_car", x+10, y+3); //R curve
        		drawBlock("blue_car", x+16, y+6); //O left
        		drawBlock("red_car", x+18, y); //O right
        		drawBlock("blue_car", x+21, y); //N left
        		drawBlock("red_car", x+25, y+6); //N right
        	} else if (num == 7) {
        		drawBlock("blue", x+8, y); //R vert
        		drawBlock("red", x+10, y+3); //R curve
        		drawBlock("blue", x+16, y+6); //O left
        		drawBlock("red", x+18, y); //O right
        		drawBlock("blue", x+21, y); //N left
        		drawBlock("red", x+25, y+6); //N right

        		drawBlock("blue_car", x+9, y); //R vert
        		drawBlock("red_car", x+10, y+4); //R curve
        		drawBlock("blue_car", x+17, y+6); //O left
        		drawBlock("red_car", x+17, y); //O right
        		drawBlock("blue_car", x+22, y+1); //N left
        		drawBlock("red_car", x+24, y+5); //N right
        	} else if (num == 8) {
        		drawBlock("blue", x+9, y); //R vert
        		drawBlock("red", x+10, y+4); //R curve
        		drawBlock("blue", x+17, y+6); //O left
        		drawBlock("red", x+17, y); //O right
        		drawBlock("blue", x+22, y+1); //N left
        		drawBlock("red", x+24, y+5); //N right

        		drawBlock("blue_car", x+10, y); //R vert
        		drawBlock("red_car", x+11, y+5); //R curve
        		drawBlock("white", x+18, y+6); //O left
        		drawBlock("white", x+16, y); //O right
        		drawBlock("blue_car", x+23, y+2); //N left
        		drawBlock("red_car", x+23, y+4); //N right
        	} else if (num == 9) {
        		drawBlock("blue", x+10, y); //R vert
        		drawBlock("red", x+11, y+5); //R curve
        		drawBlock("blue", x+23, y+2); //N left
        		drawBlock("red", x+23, y+4); //N right

        		drawBlock("white", x+11, y); //R vert
        		drawBlock("red_car", x+12, y+6); //R curve
        		drawBlock("white", x+23, y+3); //N
        	} else {
        		return false;
        	}
        	var time = setTimeout(traceTRON, 100, x, y, num+1);
        }
        function map() { //starts drawing map
        	var canvas = document.getElementById("back");
			var back = canvas.getContext("2d");
			back.clearRect(0, 0, canvas.width, canvas.height);
			var map = get("map");
			getFile(map, "map");
        	return false;
        }
        function getFile(file, type) { //gets file (and starts drawing map)
	        var url = "http://valyrknight.com/games/tron/" + file + ".txt";
			xmlhttp = new XMLHttpRequest();
			xmlhttp.open("GET", url);
			xmlhttp.send(null);	
			xmlhttp.onreadystatechange = function() {
				if (xmlhttp.readyState == 4) {
					var fileContent = xmlhttp.responseText;
					if (type == "map") {
						drawMap(fileContent);
					}
				}
			}
	      	return false;
        }
        function drawMap(text) { //draws map
        	text = text.split(":");
        	if (text == false) {
        		alert("Your browser does not support maps.");
				return false;
        	}
        	if (text[0] == "na") {
        		return false;
        	}
        	for (var q = 0; q < text.length; q++) {
        		text[q] = text[q].split(",");
        	}
        	for (var q = 0; q < text.length; q++) {
        		for (var w = 0; w < text[q].length; w++) {
        			text[q][w] = dimCalc(text[q][w]);
        		}
        	}
        	for (var q = 0; q < text.length; q++) {
        		for (var w = text[q][0]; w <= text[q][2]; w++) {
        			for (var u = text[q][1]; u <= text[q][3]; u++) {
        				drawBlock("white", u, w);
        			}
        		}
        	}
			return false;
        }
        function dimCalc(str) { //calculated dimensions for map coordinates
        	var x = parseInt(get("horzNum"));
        	var y = parseInt(get("vertNum"));
        	var side = str.substr(0, 1);
        	if (side == "m") {
        		if (str == "mv") {
        			return (y - y%2)/2;
        		} else if (str == "mh") {
        			return (x - x%2)/2;
        		}
        	}
        	var num = parseInt(str.substr(1));
        	if (side == "t") {
        		return num;
        	} else if (side == "b") {
        		return y - num;
        	} else if (side == "l") {
        		return num;
        	} else if (side == "r") {
        		return x - num;
        	}
        	return false;
        }
	</script>
	<body onload="setup();">
		<canvas id="back" width="0" height="0"></canvas>
		<div id="message_box"> <!--Menu Div-->
			<h1 id="message_title">Hello Player</h1>
			<p id="message"></p>
			<p>Move with <b class="blue">WASD</b> and <b class="pink">IJKL</b></p>
			<a id="play_button" onclick="start();">PLAY</a> <br/>
			<!--table id="maps_div">
				<tr>
					<td colspan="2"> Maps </td>
				</tr>
				<tr>
					<a id="map_button1" onclick="print('map', 'corners'); map(); return false;"><td class="map_button">Corners</td></a> 
					<a id="map_button2" onclick="print('map', 'cross'); map(); return false;"><td class="map_button">Cross</td></a> <br/>
				</tr>
				<tr>
					<a id="map_button3" onclick="print('map', 'dashes'); map(); return false;"><td class="map_button">Dashes</td></a> 
					<a id="map_button4" onclick="print('map', 'blank'); map(); return false;"><td class="map_button">Clear</td></a> 
				</tr>
			</table-->
		</div>
		<div id="store_div"> <!--Variables and stored images-->
			<p><b>Variables</b> <br/>
			horzNum: <i id="horzNum">0</i> <br/>
			vertNum: <i id="vertNum">0</i> <br/>
			redDir: <i id="redDir">r</i> <br/>
			blueDir: <i id="blueDir">l</i> <br/>
			redDirOld: <i id="redDirOld">r</i> <br/>
			blueDirOld: <i id="blueDirOld">l</i> <br/>
			redX: <i id="redX"></i> <br/>
			redY: <i id="redY"></i> <br/>
			blueX: <i id="blueX"></i> <br/>
			blueY: <i id="blueY"></i> <br/>
			redWin: <i id="redWin">0</i> <br/>
			blueWin: <i id="blueWin">0</i> <br/>
			keycode: <i id="key"></i> <br/>
			num: <i id="num">0</i> <br/>
			round: <i id="round">0</i> <br/>
			map: <i id="map">blank</i> <br/>
			</p>
			<img class="store" id="red" src="http://valyrknight.com/games/tron/red.png"/> 
			<img class="store" id="blue" src="http://valyrknight.com/games/tron/blue.png"/> 
			<img class="store" id="red_car" src="http://valyrknight.com/games/tron/red_car.png"/> 
			<img class="store" id="blue_car" src="http://valyrknight.com/games/tron/blue_car.png"/> 
			<img class="store" id="white" src="http://valyrknight.com/games/tron/white.png"/> 
			<img class="store" id="black" src="http://valyrknight.com/games/tron/black.png"/> 
			<img class="store" id="back_img" src="http://valyrknight.com/games/tron/back.png"/> 
		</div>
	</body>
</html>